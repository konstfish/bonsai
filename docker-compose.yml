version: '3.7'
services:
  mongodb:
    image: mongo:4.4.6
    volumes:
      - mongodb_data:/data/db
    restart: always

  rethink:
    image: rethinkdb:latest
    volumes:
      - rethink_data:/data
    ports:
      - 8080:8080
      - 28015:28015
      - 29015:29015
  server:
    depends_on:
      - "rethink"
    links:
      - "rethink"
    build: ./bonsai_server
    ports:
      - 4000:4000

  socket:
    depends_on:
      - "server"
      - "rethink"
    links:
      - "rethink"
    build: ./bonsai_socket
    ports:
      - 9000:9000

  frontend:
    depends_on:
      - "socket"
    build: ./bonsai_frontend/
    ports:
      - 3000:3000
    links:
      - "socket:socket"
    volumes:
      - ./data_temp:/usr/share/nginx/html/data_temp
    restart: always

  local_exporter:
    depends_on:
      - "server"
    links:
      - "server:server"
    build: ./bonsai_exporter_base

volumes:
  mongodb_data:
  rethink_data:
